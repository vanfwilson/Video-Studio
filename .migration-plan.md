# Video Studio Migration Plan: A to C Integration

## Executive Summary

**Current State:**
- **Version C** (Python/FastAPI): Deployed, working with basic video upload, caption (n8n), AI metadata (OpenRouter), YouTube publish
- **Version A** (Node.js): Complete feature set but tied to Clerk auth and Replit-specific Dropbox

**Goal:** Add Version A features to Version C incrementally, keeping the Python backend and testing as we go.

**Strategy:** Keep Version C as the production stack, port features from A one at a time.

---

## Dependencies & Blockers

### Critical Blockers

| Blocker | Impact | Resolution |
|---------|--------|------------|
| **Clerk Auth in Version A** | All A frontend pages expect Clerk | Adapt to C's custom auth |
| **Replit Dropbox Connector** | Dropbox features won't work | Implement standard OAuth |
| **Drizzle ORM in A** | Can't use A's DB layer | Use C's SQLAlchemy |

### Non-Blocking Dependencies

| Dependency | Status | Notes |
|------------|--------|-------|
| OpenRouter for AI | ✅ Working | Can use for all AI features |
| n8n Integration | ✅ Working | Can extend for more automation |
| PostgreSQL Schema | ✅ Complete | All 28 tables exist in askstephen DB |
| YouTube OAuth | ✅ Implemented | Needs testing |

---

## Phase 1: Foundation (Before Feature Work)

### 1.1 Copy shadcn/ui Components
Copy the full UI component library from A to C:
```
/opt/stacks/video-insights-repo/client/src/components/ui/*
→ /opt/stacks/video-studio/frontend/src/components/ui/
```

### 1.2 Set Up Test Subdomain
Deploy Version A on a test subdomain for comparison:
- `test.askstephen.ai` or `video-test.askstephen.ai`
- Helps validate expected behavior before porting

### 1.3 Create Shared Auth Hook
Ensure all ported pages can use Version C's auth:
```typescript
// useAuth.ts - adapter that works with C's auth
export function useAuth() {
  const { userId, user } = useUserContext();
  return { userId, user, isLoaded: !!userId };
}
```

---

## Phase 2: Complete Core Video Features

### 2.1 Backend Additions
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET `/video/:id/status` | High | Low |
| POST `/video/:id/speaker-image` | Medium | Low |
| POST `/video/:id/upload-thumbnail` | Medium | Low |
| POST `/video/:id/analyze-content-start` | Medium | Medium |
| POST `/video/:id/analyze-content-end` | Medium | Medium |
| PATCH `/video/:id/trim` | Medium | Medium |
| GET `/video/:id/clips` | Low | Medium |
| POST `/video/:id/suggest-clips` | Low | High |
| POST `/video/:id/clips` | Low | Medium |

### 2.2 Frontend Additions
| Component | Source | Lines | Complexity |
|-----------|--------|-------|------------|
| VideoEditor.tsx enhancements | Version A | +465 | Medium |
| VideoIngestProgress.tsx | Version A | 216 | Low |
| VideoWorkflow.tsx | Version A | 316 | Medium |
| ClipReview.tsx | Version A | 527 | High |

### 2.3 n8n Automation Opportunities
- Video analysis could use n8n workflows instead of hard-coded endpoints
- Clip suggestion could call AI via n8n

---

## Phase 3: Admin Features

### 3.1 Backend Additions
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET `/admin/users` | High | Low |
| POST `/admin/users` | High | Low |
| PATCH `/admin/users/:id` | High | Low |
| PATCH `/admin/users/:id/role` | High | Low |
| DELETE `/admin/users/:id` | Medium | Low |
| GET `/admin/channels` | Medium | Low |
| POST `/admin/channels` | Medium | Low |
| DELETE `/admin/channels/:id` | Medium | Low |
| GET `/admin/all-videos` | Low | Low |
| GET `/admin/export-csv` | Low | Medium |

### 3.2 Frontend Additions
| Component | Source | Lines | Complexity |
|-----------|--------|-------|------------|
| Admin.tsx | Version A | 729 | High |
| RoleBasedLayout.tsx | Version A | varies | Medium |

### 3.3 Database Models Needed
- `youtube_channels` model in Python
- `user_channels` model in Python

---

## Phase 4: Cloud Storage

### 4.1 Google Drive Integration
Since you mentioned Google OAuth could be used for GDrive:
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET `/gdrive/status` | High | Medium |
| GET `/gdrive/auth/start` | High | Medium |
| POST `/gdrive/auth/callback` | High | Medium |
| GET `/gdrive/files` | High | Medium |
| GET `/gdrive/download-link` | High | Low |

### 4.2 Dropbox Integration (New Implementation)
Replace Replit connector with standard OAuth:
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET `/dropbox/status` | Medium | Medium |
| GET `/dropbox/auth/start` | Medium | High |
| POST `/dropbox/auth/callback` | Medium | High |
| GET `/dropbox/files` | Medium | Medium |
| GET `/dropbox/download-link` | Medium | Low |

### 4.3 Cloud Connections API
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET `/cloud-connections` | High | Low |
| DELETE `/cloud-connections/:id` | High | Low |

### 4.4 Ingest Requests Enhancement
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET `/ingest-requests` | High | Low |
| GET `/ingest-requests/:id` | High | Low |
| DELETE `/ingest-requests/:id` | Medium | Low |

### 4.5 Frontend Additions
| Component | Source | Lines | Complexity |
|-----------|--------|-------|------------|
| CloudStorage.tsx | New | ~200 | Medium |
| DropboxFileBrowser.tsx | Rewrite | varies | High |
| CloudVideoSelector.tsx | Version A | varies | Medium |
| CloudStorageSettings.tsx | Version A | varies | Medium |

---

## Phase 5: Business Tools (Workbook)

### 5.1 Backend Additions
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET/POST `/workbook/progress` | High | Low |
| GET/POST `/workbook/core-value` | High | Medium |
| GET/POST `/workbook/swot` | High | Medium |
| GET `/workbook/swot/all` | Medium | Low |
| GET/POST `/workbook/root-cause` | Medium | Medium |
| GET/POST `/workbook/time-audit` | Medium | Medium |
| GET/POST `/workbook/action-plan` | Medium | Medium |
| POST `/workbook/ai-coach` | Low | High |

### 5.2 Database Models Needed
- WorkbookProgress
- CoreValues
- WorkbookSwotAnalysis
- RootCauseChart
- TimeAudit
- ActionPlan
- AiCoachConversation

### 5.3 Frontend Additions
| Component | Source | Lines | Complexity |
|-----------|--------|-------|------------|
| WorkbookDashboard.tsx | Version A | 282 | Medium |
| WorkbookCoreValue.tsx | Version A | 544 | High |
| WorkbookSWOT.tsx | Version A | 375 | High |
| WorkbookRootCause.tsx | Version A | 389 | Medium |
| WorkbookTimeAudit.tsx | Version A | 418 | Medium |
| WorkbookActionPlan.tsx | Version A | 460 | Medium |

### 5.4 n8n Integration Opportunity
- AI Coach could be an n8n workflow instead of hard-coded endpoint

---

## Phase 6: Leads & Business Intelligence

### 6.1 Backend Additions
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET/POST/DELETE `/leads/clients` | High | Medium |
| GET/POST `/leads/clients/:id/swot` | High | Medium |
| GET `/leads/clients/:id/searches` | Medium | Medium |
| POST `/leads/clients/:id/search` | Medium | High |
| POST `/leads/webhook/results` | Medium | Medium |
| POST `/intel/callback` | High | Medium |
| POST `/intel/analyze` | Medium | High |
| GET `/intel/results/:id` | Medium | Medium |

### 6.2 Database Models Needed
- Company
- CompanyMembership
- BusinessLead
- LeadsClient
- LeadsSearch
- LeadsSearchSchedule
- LeadsSwotAnalysis
- CompetitorSnapshot
- CompetitorChange
- ReferralPartnerCategory

### 6.3 Frontend Additions
| Component | Source | Lines | Complexity |
|-----------|--------|-------|------------|
| Leads.tsx | Version A | 1,035 | Very High |
| SwotAnalysisPage.tsx | Version A | 238 | Medium |
| intel/AnalyzeTrigger.tsx | Version A | varies | Medium |
| intel/PartnersDisplay.tsx | Version A | varies | Low |
| intel/ReviewsDisplay.tsx | Version A | varies | Low |

### 6.4 n8n Integration
- Lead search should definitely use n8n
- Business intel analysis via n8n webhook (already suggested in code)

---

## Phase 7: Additional Features

### 7.1 Semantic Search
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| POST `/search` | Medium | High |
| GET `/search/history` | Low | Low |

Frontend: SemanticSearch.tsx (375 lines)

### 7.2 Confidentiality Check
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| POST `/video/:id/confidentiality-check` | Medium | High |
| GET `/video/:id/confidentiality-check` | Medium | Medium |

### 7.3 Chat/Conversations
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| GET/POST/DELETE `/conversations` | Low | Medium |
| GET `/conversations/:id` | Low | Low |
| POST `/conversations/:id/messages` | Low | Medium |

### 7.4 Image Generation
| Endpoint | Priority | Complexity |
|----------|----------|------------|
| POST `/generate-image` | Low | Low |

---

## Testing Strategy

### Option A: Keep C as Primary, Test Features Locally
1. Make changes to C
2. Test on production domain
3. Rollback if issues

### Option B: Test Subdomain (Recommended)
1. Create `test.askstephen.ai` subdomain
2. Deploy Version A or new C features there
3. Test thoroughly before merging to production

### Option C: Feature Flags
1. Add feature flags to C
2. Enable new features for specific users
3. Gradual rollout

---

## Implementation Order (Recommended)

| Week | Phase | Deliverable |
|------|-------|-------------|
| 1 | Foundation | shadcn/ui copied, test subdomain ready |
| 2-3 | Phase 2 | Core video features complete |
| 4 | Phase 3 | Admin features complete |
| 5-6 | Phase 4 | Cloud storage (GDrive first, then Dropbox) |
| 7-8 | Phase 5 | Workbook features |
| 9-10 | Phase 6 | Leads & Intel |
| 11+ | Phase 7 | Additional features |

---

## Files Created During Analysis

1. `/opt/stacks/video-studio/.api-comparison.md` - Detailed API endpoint comparison
2. `/opt/stacks/video-studio/.frontend-comparison.md` - Frontend component comparison
3. `/opt/stacks/video-studio/.migration-plan.md` - This document
4. `/opt/stacks/video-studio/.video-insights-analysis.md` - Initial repo analysis
5. `/opt/stacks/video-studio/.schema-comparison.md` - Database schema comparison

---

## Next Steps

1. **Review this plan** - Confirm priorities and approach
2. **Set up test subdomain** - For safe testing
3. **Start Phase 1** - Copy UI components
4. **Begin Phase 2** - Core video enhancements

Would you like to:
- Start with Phase 1 foundation work?
- Set up the test subdomain first?
- Adjust priorities in this plan?
- Deploy Version A to test subdomain to compare behavior?
